{{!-- templates/apps/gm-grant-dialog.hbs --}}
<div class="gm-grant-container">

  {{!-- Categorías --}}
  <div class="category-tabs">
    <button class="category-tab {{#if (eq category 'weapons')}}active{{/if}}"
            data-action="select-category" data-category="weapons">
      <i class="fas fa-sword"></i> Armas
    </button>
    <button class="category-tab {{#if (eq category 'armor')}}active{{/if}}"
            data-action="select-category" data-category="armor">
      <i class="fas fa-shield"></i> Armaduras
    </button>
    <button class="category-tab {{#if (eq category 'jewelry')}}active{{/if}}"
            data-action="select-category" data-category="jewelry">
      <i class="fas fa-ring"></i> Joyas
    </button>
    <button class="category-tab {{#if (eq category 'designs')}}active{{/if}}"
            data-action="select-category" data-category="designs">
      <i class="fas fa-scroll"></i> Diseños
    </button>
    <button class="category-tab {{#if (eq category 'formulas')}}active{{/if}}"
            data-action="select-category" data-category="formulas">
      <i class="fas fa-flask"></i> Fórmulas
    </button>
    <button class="category-tab {{#if (eq category 'blueprints')}}active{{/if}}"
            data-action="select-category" data-category="blueprints">
      <i class="fas fa-drafting-compass"></i> Planos
    </button>
    <button class="category-tab {{#if (eq category 'diagrams')}}active{{/if}}"
            data-action="select-category" data-category="diagrams">
      <i class="fas fa-project-diagram"></i> Diagramas
    </button>
    <button class="category-tab {{#if (eq category 'materials')}}active{{/if}}"
            data-action="select-category" data-category="materials">
      <i class="fas fa-gem"></i> Materiales
    </button>
    <button class="category-tab {{#if (eq category 'consumables')}}active{{/if}}"
            data-action="select-category" data-category="consumables">
      <i class="fas fa-cookie-bite"></i> Consumibles
    </button>
    <button class="category-tab {{#if (eq category 'kits')}}active{{/if}}"
            data-action="select-category" data-category="kits">
      <i class="fas fa-toolbox"></i> Kits
    </button>
    <button class="category-tab {{#if (eq category 'relics')}}active{{/if}}"
            data-action="select-category" data-category="relics">
      <i class="fas fa-star"></i> Reliquias
    </button>
    <button class="category-tab {{#if (eq category 'maneuvers')}}active{{/if}}"
            data-action="select-category" data-category="maneuvers">
      <i class="fas fa-fist-raised"></i> Maniobras
    </button>
  </div>

  <div class="grant-content">
    {{!-- Selección de Jugadores --}}
    <div class="players-section">
      <h3>Seleccionar Jugadores</h3>
      {{#if players.length}}
        <div class="players-list">
          {{#each players}}
            <label class="player-checkbox">
              <input type="checkbox" name="player-select" value="{{characterId}}" {{#if selected}}checked{{/if}}>
              <span class="player-name">{{name}}</span>
              <span class="character-name">({{characterName}})</span>
            </label>
          {{/each}}
        </div>
      {{else}}
        <p class="no-players">No hay jugadores con personajes asignados.</p>
      {{/if}}
    </div>

    {{!-- Lista de Items --}}
    <div class="items-section">
      <div class="section-header">
        <h3>Items Disponibles</h3>
        <div class="search-container">
          <input type="text"
                 class="search-input"
                 name="search-query"
                 placeholder="Buscar..."
                 value="{{searchQuery}}">
          <button class="secondary" data-action="create-custom">
            <i class="fas fa-plus"></i> Crear Custom
          </button>
        </div>
      </div>

      {{!-- Subcategorías para Armas/Armaduras --}}
      {{#if subcategories.length}}
        <div class="subcategory-tabs">
          <button class="subcategory-tab {{#unless subcategory}}active{{/unless}}"
                  data-action="select-subcategory" data-subcategory="">
            Todas
          </button>
          {{#each subcategories}}
            <button class="subcategory-tab {{#if selected}}active{{/if}}"
                    data-action="select-subcategory" data-subcategory="{{key}}">
              {{label}}
            </button>
          {{/each}}
        </div>
      {{/if}}

      {{#if items.length}}
        <div class="items-grid">
          {{#each items}}
            <div class="item-card">
              <div class="item-header">
                <h4>{{label}}</h4>
                {{#if subtype}}
                  <span class="item-type-badge">{{subtype}}</span>
                {{else if type}}
                  <span class="item-type-badge">{{type}}</span>
                {{/if}}
              </div>
              {{#if info}}
                <div class="item-info">{{info}}</div>
              {{/if}}
              <div class="item-actions">
                <input type="number"
                       value="1"
                       min="1"
                       max="999"
                       data-item="{{key}}"
                       class="quantity-input">
                <button class="primary grant-btn"
                        data-action="grant-item"
                        data-item-key="{{key}}"
                        data-item-label="{{label}}"
                        data-item-type="{{type}}"
                        data-needs-material="{{needsMaterial}}">
                  <i class="fas fa-treasure-chest"></i> Otorgar
                </button>
              </div>
            </div>
          {{/each}}
        </div>
      {{else}}
        <p class="no-items">No hay items en esta categoría.</p>
      {{/if}}
    </div>
  </div>

  <style>
  .gm-grant-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: linear-gradient(135deg, #2a1810 0%, #1a0f08 100%);
    color: #e8d7c3;
    overflow: hidden;
  }

  /* Tabs de Categorías */
  .category-tabs {
    display: flex;
    gap: 4px;
    padding: 0.5rem;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 2px solid #8b6f47;
    overflow-x: auto;
    flex-wrap: wrap;
  }

  .category-tab {
    padding: 0.5rem 1rem;
    background: rgba(139, 111, 71, 0.1);
    border: 1px solid #8b6f47;
    border-radius: 6px;
    color: #d4af77;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    font-size: 0.9rem;
  }

  .category-tab:hover {
    background: rgba(139, 111, 71, 0.2);
    border-color: #d4af77;
  }

  .category-tab.active {
    background: #8b6f47;
    color: #fff;
    border-color: #d4af77;
  }

  .category-tab i {
    margin-right: 0.5rem;
  }

  /* Contenido Principal */
  .grant-content {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 1rem;
    padding: 1rem;
    overflow: hidden;
    flex: 1;
  }

  /* Sección de Jugadores */
  .players-section {
    background: rgba(139, 111, 71, 0.1);
    border: 1px solid #8b6f47;
    border-radius: 8px;
    padding: 1rem;
    overflow-y: auto;
  }

  .players-section h3 {
    margin: 0 0 1rem 0;
    color: #d4af77;
    font-size: 1rem;
    border-bottom: 1px solid #8b6f47;
    padding-bottom: 0.5rem;
  }

  .players-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .player-checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .player-checkbox:hover {
    background: rgba(139, 111, 71, 0.2);
  }

  .player-checkbox input[type="checkbox"] {
    margin: 0;
  }

  .player-name {
    font-weight: bold;
    color: #d4af77;
  }

  .character-name {
    color: #b8a58f;
    font-size: 0.85rem;
  }

  .no-players {
    color: #b8a58f;
    font-style: italic;
    text-align: center;
    padding: 2rem;
  }

  /* Sección de Items */
  .items-section {
    background: rgba(139, 111, 71, 0.1);
    border: 1px solid #8b6f47;
    border-radius: 8px;
    padding: 1rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #8b6f47;
    padding-bottom: 0.5rem;
  }

  .section-header h3 {
    margin: 0;
    color: #d4af77;
    font-size: 1rem;
  }

  .search-container {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .search-input {
    padding: 0.4rem 0.8rem;
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid #8b6f47;
    border-radius: 4px;
    color: #e8d7c3;
    min-width: 200px;
  }

  .search-input::placeholder {
    color: #b8a58f;
  }

  .section-header button {
    padding: 0.4rem 0.8rem;
    font-size: 0.85rem;
  }

  /* Subcategorías */
  .subcategory-tabs {
    display: flex;
    gap: 0.5rem;
    padding: 0.75rem;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 6px;
    overflow-x: auto;
    flex-wrap: wrap;
  }

  .subcategory-tab {
    padding: 0.4rem 0.8rem;
    background: rgba(139, 111, 71, 0.15);
    border: 1px solid #8b6f47;
    border-radius: 4px;
    color: #d4af77;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    font-size: 0.85rem;
  }

  .subcategory-tab:hover {
    background: rgba(139, 111, 71, 0.25);
    border-color: #d4af77;
  }

  .subcategory-tab.active {
    background: #8b6f47;
    color: #fff;
    border-color: #d4af77;
  }

  /* Grid de Items */
  .items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 0.75rem;
  }

  .item-card {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #8b6f47;
    border-radius: 6px;
    padding: 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    transition: all 0.2s;
  }

  .item-card:hover {
    border-color: #d4af77;
    background: rgba(139, 111, 71, 0.1);
  }

  .item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 0.5rem;
  }

  .item-header h4 {
    margin: 0;
    color: #f5e6d3;
    font-size: 0.95rem;
    flex: 1;
  }

  .item-type-badge {
    background: rgba(139, 111, 71, 0.3);
    color: #d4af77;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    text-transform: uppercase;
  }

  .item-info {
    color: #b8a58f;
    font-size: 0.8rem;
    padding: 0.25rem 0;
    border-top: 1px solid rgba(139, 111, 71, 0.3);
  }

  .item-actions {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .quantity-input {
    width: 60px;
    padding: 0.3rem;
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid #8b6f47;
    border-radius: 4px;
    color: #e8d7c3;
    text-align: center;
  }

  .grant-btn {
    flex: 1;
    padding: 0.4rem 0.8rem;
    font-size: 0.85rem;
  }

  .no-items {
    color: #b8a58f;
    font-style: italic;
    text-align: center;
    padding: 2rem;
  }

  /* Scrollbars */
  .players-section::-webkit-scrollbar,
  .items-section::-webkit-scrollbar {
    width: 8px;
  }

  .players-section::-webkit-scrollbar-track,
  .items-section::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
  }

  .players-section::-webkit-scrollbar-thumb,
  .items-section::-webkit-scrollbar-thumb {
    background: #8b6f47;
    border-radius: 4px;
  }

  .players-section::-webkit-scrollbar-thumb:hover,
  .items-section::-webkit-scrollbar-thumb:hover {
    background: #d4af77;
  }

  /* Mensaje en Chat */
  .gm-grant-message {
    background: linear-gradient(135deg, #2a1810 0%, #1a0f08 100%);
    border: 2px solid #8b6f47;
    border-radius: 8px;
    padding: 1rem;
    color: #e8d7c3;
  }

  .gm-grant-message h3 {
    margin: 0 0 0.5rem 0;
    color: #d4af77;
    border-bottom: 1px solid #8b6f47;
    padding-bottom: 0.5rem;
  }

  .gm-grant-message p {
    margin: 0.5rem 0;
  }
  </style>
</div>
