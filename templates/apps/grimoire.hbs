<div class="tsdc-grimoire">
  <header class="g-head" style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
    <div class="g-title"><i class="fa-solid fa-book" style="margin-right:6px;"></i>Necronomicón — <b>{{actorName}}</b></div>

    <div class="g-plan" style="display:flex;align-items:center;gap:8px;margin-left:12px;">
      <div>Plan: <b>{{planningTick}}</b></div>
    </div>

    <div class="g-filter" style="display:flex;align-items:center;gap:6px;margin-left:16px;">
      <input data-ref="filter" type="text" placeholder="Buscar…" value="{{query}}" style="width:260px;">
      <button type="button" data-action="apply-filter">Filtrar</button>
    </div>

    <span style="flex:1;"></span>
    <nav class="g-tabs" style="display:flex; gap:6px;">
      <button type="button" data-action="switch-tab" data-tab="basic"    class="{{#if (eq activeTab "basic")}}active{{/if}}">Básicas</button>
      <button type="button" data-action="switch-tab" data-tab="natural"   class="{{#if (eq activeTab "natural")}}active{{/if}}">Armas Nat.</button>
      <button type="button" data-action="switch-tab" data-tab="maneuvers" class="{{#if (eq activeTab "maneuvers")}}active{{/if}}">Maniobras</button>
      <button type="button" data-action="switch-tab" data-tab="relics"    class="{{#if (eq activeTab "relics")}}active{{/if}}">Reliquias</button>
      <button type="button" data-action="switch-tab" data-tab="aptitudes" class="{{#if (eq activeTab "aptitudes")}}active{{/if}}">Aptitudes</button>
    </nav>
    <button type="button" data-action="close">Cerrar</button>
  </header>

  <div class="g-body">
    <!-- Básicas -->
    {{#if (eq activeTab "basic")}}
    <section class="g-section">
      <div class="g-list" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
        {{#each cardsBasic as |c|}}
          <details class="g-item" data-card data-id="{{c.id}}">
            <summary style="padding:8px;border-radius:8px;background:var(--color-underline-header);cursor:pointer;">
              <b>{{c.title}}</b>
              <span style="opacity:.7;margin-left:8px;">{{c.subtitle}}</span>
              <a style="float:right; font-size:12px; opacity:.8;" data-action="open-plan">Planear en ATB</a>
            </summary>
            <div class="g-card" style="margin-top:8px;">{{{c.html}}}</div>
          </details>
        {{/each}}
      </div>
    </section>
    {{/if}}

    <!-- Armas Naturales -->
    {{#if (eq activeTab "natural")}}
    <section class="g-section">
      {{#if cardsNaturalWeapons}}
      <div class="g-list" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
        {{#each cardsNaturalWeapons as |c|}}
          <details class="g-item" data-card data-id="{{c.id}}">
            <summary style="padding:8px;border-radius:8px;background:var(--color-underline-header);cursor:pointer;">
              <b>{{c.title}}</b>
              <span style="opacity:.7;margin-left:8px;">{{c.subtitle}}</span>
              <a style="float:right; font-size:12px; opacity:.8;" data-action="open-plan">Planear en ATB</a>
            </summary>
            <div class="g-card" style="margin-top:8px;">{{{c.html}}}</div>
          </details>
        {{/each}}
      </div>
      {{else}}
      <p style="text-align:center; opacity:0.7; margin:20px 0;">No tienes armas naturales disponibles.</p>
      {{/if}}
    </section>
    {{/if}}

    <!-- Maniobras -->
    {{#if (eq activeTab "maneuvers")}}
    <section class="g-section">
      <div class="g-list" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
        {{#each cardsManeuvers as |c|}}
          <details class="g-item" data-card data-id="{{c.id}}">
            <summary style="padding:8px;border-radius:8px;background:var(--color-underline-header);cursor:pointer;">
              <b>{{c.title}}</b>
              <span style="opacity:.7;margin-left:8px;">{{c.subtitle}}</span>
              <a style="float:right; font-size:12px; opacity:.8;" data-action="open-plan">Planear en ATB</a>
            </summary>
            <div class="g-card" style="margin-top:8px;">{{{c.html}}}</div>
          </details>
        {{/each}}
      </div>
    </section>
    {{/if}}

    <!-- Reliquias -->
    {{#if (eq activeTab "relics")}}
    <section class="g-section">
      <div class="g-list" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
        {{#each cardsRelics as |c|}}
          <details class="g-item" data-card data-id="{{c.id}}">
            <summary style="padding:8px;border-radius:8px;background:var(--color-underline-header);cursor:pointer;">
              <b>{{c.title}}</b>
              <span style="opacity:.7;margin-left:8px;">{{c.subtitle}}</span>
              <a style="float:right; font-size:12px; opacity:.8;" data-action="open-plan">Planear en ATB</a>
            </summary>
            <div class="g-card" style="margin-top:8px;">{{{c.html}}}</div>
          </details>
        {{/each}}
      </div>
    </section>
    {{/if}}

    <!-- Aptitudes -->
    {{#if (eq activeTab "aptitudes")}}
    <section class="g-section">
      <div class="g-list" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
        {{#each cardsAptitudes as |c|}}
          <details class="g-item" data-card data-id="{{c.id}}">
            <summary style="padding:8px;border-radius:8px;background:var(--color-underline-header);cursor:pointer;">
              <b>{{c.title}}</b>
              <span style="opacity:.7;margin-left:8px;">{{c.subtitle}}</span>
              <a style="float:right; font-size:12px; opacity:.8;" data-action="open-plan">Planear en ATB</a>
            </summary>
            <div class="g-card" style="margin-top:8px;">{{{c.html}}}</div>
          </details>
        {{/each}}
      </div>
    </section>
    {{/if}}
  </div>

  <style>
    .tsdc-grimoire {
      background: linear-gradient(135deg, #2a1810 0%, #1a0f08 100%);
      color: var(--t-text);
      padding: 16px;
      border-radius: 12px;
    }

    .tsdc-grimoire .g-head {
      border-bottom: 2px solid var(--t-border);
      padding-bottom: 12px;
      margin-bottom: 16px;
    }

    .tsdc-grimoire .g-title {
      color: var(--t-accent);
      font-size: 18px;
      font-weight: 600;
    }

    .tsdc-grimoire .g-plan,
    .tsdc-grimoire .g-filter {
      color: var(--t-text);
    }

    .tsdc-grimoire input[type="text"] {
      background: var(--t-elev);
      border: 1px solid var(--t-border);
      color: var(--t-text);
      padding: 6px 10px;
      border-radius: 8px;
    }

    .tsdc-grimoire input[type="text"]:focus {
      outline: none;
      border-color: var(--t-accent);
      box-shadow: 0 0 0 2px rgba(212, 175, 119, 0.2);
    }

    .tsdc-grimoire button {
      background: var(--t-accent-2);
      border: 1px solid var(--t-border);
      color: var(--t-text);
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tsdc-grimoire button:hover {
      background: var(--t-accent);
      border-color: var(--t-accent);
    }

    .tsdc-grimoire button.active {
      background: var(--t-accent);
      color: white;
      border-color: var(--t-accent);
    }

    .tsdc-grimoire .g-item summary {
      background: var(--t-elev) !important;
      border: 1px solid var(--t-border);
      transition: all 0.2s;
    }

    .tsdc-grimoire .g-item summary:hover {
      background: rgba(212, 175, 119, 0.08) !important;
      border-color: var(--t-accent);
    }

    .tsdc-grimoire .g-item summary b {
      color: var(--t-accent);
    }

    .tsdc-grimoire .g-item summary span {
      color: var(--t-muted);
    }

    .tsdc-grimoire .g-item summary a {
      color: var(--t-accent);
      text-decoration: none;
    }

    .tsdc-grimoire .g-item summary a:hover {
      text-decoration: underline;
    }

    .tsdc-grimoire .g-card {
      background: var(--t-elev);
      border: 1px solid var(--t-border);
      border-radius: 8px;
      padding: 12px;
      color: var(--t-text);
    }

    .tsdc-grimoire .g-body {
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .tsdc-grimoire .g-body::-webkit-scrollbar {
      width: 8px;
    }

    .tsdc-grimoire .g-body::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }

    .tsdc-grimoire .g-body::-webkit-scrollbar-thumb {
      background: var(--t-accent-2);
      border-radius: 4px;
    }

    .tsdc-grimoire .g-body::-webkit-scrollbar-thumb:hover {
      background: var(--t-accent);
    }
  </style>
</div>