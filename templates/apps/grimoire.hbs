<div class="tsdc-grimoire">
  <header class="g-head" style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
    <div class="g-title"><i class="fa-solid fa-book" style="margin-right:6px;"></i>Necronomicón — <b>{{actorName}}</b></div>

    <div class="g-plan" style="display:flex;align-items:center;gap:8px;margin-left:12px;">
      <div>Plan: <b>{{planningTick}}</b></div>
    </div>

    <div class="g-filter" style="display:flex;align-items:center;gap:6px;margin-left:16px;">
      <input data-ref="filter" type="text" placeholder="Buscar…" value="{{query}}" style="width:260px;">
      <button type="button" data-action="apply-filter">Filtrar</button>
    </div>

    <span style="flex:1;"></span>
    <nav class="g-tabs" style="display:flex; gap:6px;">
      <button type="button" data-action="switch-tab" data-tab="basic"    class="{{#if (eq activeTab "basic")}}active{{/if}}">Básicas</button>
      <button type="button" data-action="switch-tab" data-tab="natural"   class="{{#if (eq activeTab "natural")}}active{{/if}}">Armas Nat.</button>
      <button type="button" data-action="switch-tab" data-tab="maneuvers" class="{{#if (eq activeTab "maneuvers")}}active{{/if}}">Maniobras</button>
      <button type="button" data-action="switch-tab" data-tab="relics"    class="{{#if (eq activeTab "relics")}}active{{/if}}">Reliquias</button>
      <button type="button" data-action="switch-tab" data-tab="aptitudes" class="{{#if (eq activeTab "aptitudes")}}active{{/if}}">Aptitudes</button>
    </nav>
    <button type="button" data-action="close">Cerrar</button>
  </header>

  <div class="g-body">
    <!-- Básicas -->
    {{#if (eq activeTab "basic")}}
    <section class="g-section">
      <div class="g-list" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
        {{#each cardsBasic as |c|}}
          <details class="g-item" data-card data-id="{{c.id}}">
            <summary style="padding:8px;border-radius:8px;background:var(--color-underline-header);cursor:pointer;">
              <b>{{c.title}}</b>
              <span style="opacity:.7;margin-left:8px;">{{c.subtitle}}</span>
              <a style="float:right; font-size:12px; opacity:.8;" data-action="open-plan">Planear en ATB</a>
            </summary>
            <div class="g-card" style="margin-top:8px;">{{{c.html}}}</div>
          </details>
        {{/each}}
      </div>
    </section>
    {{/if}}

    <!-- Armas Naturales -->
    {{#if (eq activeTab "natural")}}
    <section class="g-section">
      {{#if cardsNaturalWeapons}}
      <div class="g-list" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
        {{#each cardsNaturalWeapons as |c|}}
          <details class="g-item" data-card data-id="{{c.id}}">
            <summary style="padding:8px;border-radius:8px;background:var(--color-underline-header);cursor:pointer;">
              <b>{{c.title}}</b>
              <span style="opacity:.7;margin-left:8px;">{{c.subtitle}}</span>
              <a style="float:right; font-size:12px; opacity:.8;" data-action="open-plan">Planear en ATB</a>
            </summary>
            <div class="g-card" style="margin-top:8px;">{{{c.html}}}</div>
          </details>
        {{/each}}
      </div>
      {{else}}
      <p style="text-align:center; opacity:0.7; margin:20px 0;">No tienes armas naturales disponibles.</p>
      {{/if}}
    </section>
    {{/if}}

    <!-- Maniobras -->
    {{#if (eq activeTab "maneuvers")}}
    <section class="g-section">
      <div class="g-list" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
        {{#each cardsManeuvers as |c|}}
          <details class="g-item" data-card data-id="{{c.id}}">
            <summary style="padding:8px;border-radius:8px;background:var(--color-underline-header);cursor:pointer;">
              <b>{{c.title}}</b>
              <span style="opacity:.7;margin-left:8px;">{{c.subtitle}}</span>
              <a style="float:right; font-size:12px; opacity:.8;" data-action="open-plan">Planear en ATB</a>
            </summary>
            <div class="g-card" style="margin-top:8px;">{{{c.html}}}</div>
          </details>
        {{/each}}
      </div>
    </section>
    {{/if}}

    <!-- Reliquias -->
    {{#if (eq activeTab "relics")}}
    <section class="g-section">
      <div class="g-list" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
        {{#each cardsRelics as |c|}}
          <details class="g-item" data-card data-id="{{c.id}}">
            <summary style="padding:8px;border-radius:8px;background:var(--color-underline-header);cursor:pointer;">
              <b>{{c.title}}</b>
              <span style="opacity:.7;margin-left:8px;">{{c.subtitle}}</span>
              <a style="float:right; font-size:12px; opacity:.8;" data-action="open-plan">Planear en ATB</a>
            </summary>
            <div class="g-card" style="margin-top:8px;">{{{c.html}}}</div>
          </details>
        {{/each}}
      </div>
    </section>
    {{/if}}

    <!-- Aptitudes -->
    {{#if (eq activeTab "aptitudes")}}
    <section class="g-section">
      <div class="g-list" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
        {{#each cardsAptitudes as |c|}}
          <details class="g-item" data-card data-id="{{c.id}}">
            <summary style="padding:8px;border-radius:8px;background:var(--color-underline-header);cursor:pointer;">
              <b>{{c.title}}</b>
              <span style="opacity:.7;margin-left:8px;">{{c.subtitle}}</span>
              <a style="float:right; font-size:12px; opacity:.8;" data-action="open-plan">Planear en ATB</a>
            </summary>
            <div class="g-card" style="margin-top:8px;">{{{c.html}}}</div>
          </details>
        {{/each}}
      </div>
    </section>
    {{/if}}
  </div>
</div>